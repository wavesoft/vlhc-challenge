/*! CCL-Tracker v0.1 | Ioannis Charalampidis, Citizen Cyberlab EU Project | GNU GPL v2.0 License */
(window.define==undefined?function(a){window.analytics=a()}:window.define)(function(){function c(){function d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}var f="";for(var e=0;e<8;e++){f+=d()}return f}var b=function(){this.stack=[];this.enabled=false;this.expired=false;this.initializedAt=Date.now();this.timeoutTime=this.initializedAt+10000;this.listener=null;this.debug=false;this.trackingID=null;this.timers={};this.timerAccummulators={};this.globals={};this.probeTimer=setInterval(this.probeListener.bind(this),100);this.trackingID=this.getCookie("_ccl_tracking_id");if(!this.trackingID){this.trackingID=c();this.createCookie("_ccl_tracking_id",this.trackingID,365)}this.globals.trackid=this.trackingID};b.prototype.createCookie=function(f,g,h){var d;if(h){var e=new Date();e.setTime(e.getTime()+(h*24*60*60*1000));d="; expires="+e.toGMTString()}else{d=""}document.cookie=f+"="+g+d+"; path=/"};b.prototype.getCookie=function(d){if(document.cookie.length>0){c_start=document.cookie.indexOf(d+"=");if(c_start!=-1){c_start=c_start+d.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""};b.prototype.disable=function(){this.expired=true;this.enabled=false};b.prototype.probeListener=function(){if(this.enabled||this.expired){return}if(Date.now()>this.timeoutTime){clearInterval(this.probeTimer);this.expired=true;this.stack=[];console.warn("Analytics: No back-end registered on time");return}if(!window.analyticsListener){return}clearInterval(this.probeTimer);this.listener=window.analyticsListener;this.enabled=true;if(this.debug){console.log("Analytics: Registered back-end")}for(var d=0;d<this.stack.length;d++){this.send(this.stack[d][0],this.stack[d][1])}this.stack=[]};b.prototype.fireEvent=function(d,g,f){this.probeListener();if(this.expired){return}if(!g){g={}}for(k in this.globals){g[k]=this.globals[k]}if(this.enabled){this.send(d,g)}else{if(f){for(var e=0;e<this.stack.length;e++){if(this.stack[e][0]==d){this.stack[e]=[d,g];return}}}this.stack.push([d,g]);if(this.debug){console.log("Analytics: Scheduling",d,g)}}};b.prototype.send=function(d,f){if(f.ts==undefined){f.ts=Date.now()}if(this.debug){console.log("Analytics: Sending",d,f)}if(this.listener){try{if(this.listener===true){$(window).trigger("analytics."+d,[f])}else{this.listener(d,f)}}catch(g){}}};b.prototype.setGlobal=function(d,e){this.globals[d]=e};b.prototype.freeze=function(){for(name in this.timers){this.timerAccummulators[name]+=(Date.now()-this.timers[name])}};b.prototype.thaw=function(){for(name in this.timers){this.timers[name]=Date.now()}};b.prototype.startTimer=function(d){if(this.timers[d]!==undefined){return}this.timers[d]=Date.now();this.timerAccummulators[d]=0};b.prototype.restartTimer=function(d){var e=this.stopTimer(d);this.timers[d]=Date.now();this.timerAccummulators[d]=0;return e};b.prototype.getTimer=function(d){if(!this.timers[d]){return 0}return(Date.now()-this.timers[d])+this.timerAccummulators[d]};b.prototype.stopTimer=function(d){if(!this.timers[d]){return 0}var e=(Date.now()-this.timers[d])+this.timerAccummulators[d];delete this.timers[d];delete this.timerAccummulators[d];return e};var a=new b();window.addEventListener("blur",function(d){a.freeze()});window.addEventListener("focus",function(d){a.thaw()});return a});